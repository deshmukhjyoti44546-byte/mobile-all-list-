<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile Tracker Pro</title>
<style>
:root {
  --bg-primary: #f8fafc;
  --bg-secondary: #fff;
  --text-primary: #1e293b;
  --text-secondary: #475569;
  --border-color: #e2e8f0;
  --header-bg: #1e3a8a;
  --header-text: #fff;
  --accent-blue: #3b82f6;
  --accent-green: #10b981;
  --accent-yellow: #f59e0b;
  --accent-red: #ef4444;
  --accent-orange: #f97316;
  --accent-purple: #8b5cf6;
  --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
  --transition: all 0.3s ease;
}

[data-theme="dark"] {
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --border-color: #334155;
  --header-bg: #0f172a;
  --header-text: #cbd5e1;
  --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.3), 0 2px 4px -1px rgba(0,0,0,0.25);
}

* { margin: 0; padding: 0; box-sizing: border-box }
body {
  font-family: 'Segoe UI', system-ui, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.5;
  padding: 0;
  margin: 0;
  min-height: 100vh;
  transition: var(--transition);
}
#loginModal, #settingsModal, #editModal {
  display: flex;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 2000;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
}
.modal-content {
  background: var(--bg-secondary);
  border-radius: 20px;
  padding: 40px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  transform: translateY(0);
  animation: modalSlide 0.4s ease-out;
  position: relative;
  max-height: 90vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
@keyframes modalSlide {
  from { transform: translateY(30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.modal h2 {
  text-align: center;
  margin-bottom: 25px;
  color: var(--header-bg);
  font-size: 2.2rem;
  padding-top: 10px;
}
.modal input, .modal select {
  width: 100%;
  padding: 16px;
  margin: 12px 0;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 16px;
  transition: var(--transition);
}
.modal input:focus, .modal select:focus {
  outline: none;
  border-color: var(--accent-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}
.modal-buttons {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}
.btn {
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: var(--transition);
  flex: 1;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
.btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
.btn:active { transform: translateY(0); }
.btn-primary { background: var(--accent-blue); color: white }
.btn-old { background: var(--accent-yellow); color: #0f172a }
.btn-sort { background: #64748b; color: white }
.btn-dark { background: #64748b; color: white; padding: 10px; width: 48px; height: 48px; border-radius: 50% }
.btn-settings { background: var(--accent-purple); color: white; padding: 10px; width: 48px; height: 48px; border-radius: 50% }
.btn-delete { background: var(--accent-red); color: white; padding: 8px 16px; min-width: 90px }
.btn-success { background: var(--accent-green); color: white }
.btn-cancel { background: #64748b; color: white }
.btn-back { 
  background: var(--accent-orange); 
  color: white; 
  width: 100%; 
  padding: 16px; 
  margin-top: 20px; 
  font-size: 1.1rem;
  position: sticky;
  bottom: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.btn-toggle { padding: 12px; font-size: 15px; min-width: 120px; }
.error { color: var(--accent-red); text-align: center; margin-top: 10px; font-weight: 500; min-height: 24px }
#appContainer { display: none; padding: 20px; }
.container {
  max-width: 1000px;
  margin: 0 auto;
  background: var(--bg-secondary);
  border-radius: 20px;
  box-shadow: var(--card-shadow);
  padding: 30px;
  position: relative;
  transition: var(--transition);
}
.top-bar {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 15px;
  z-index: 100;
}
.header {
  text-align: center;
  margin-bottom: 25px;
  position: relative;
}
h1 {
  font-size: 2.4rem;
  color: var(--header-bg);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}
.subtitle {
  color: var(--text-secondary);
  font-size: 1.2rem;
  margin-top: 5px;
}
.stats-panel {
  background: var(--bg-primary);
  padding: 18px;
  border-radius: 16px;
  margin: 20px 0;
  font-weight: 600;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  text-align: center;
  box-shadow: var(--card-shadow);
  border: 1px solid var(--border-color);
}
.stats-item { padding: 8px; }
.stats-label { font-size: 0.9rem; color: var(--text-secondary); display: block; margin-bottom: 4px; }
.stats-value { font-size: 1.8rem; font-weight: 800; }
.actions-bar {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 15px;
  margin: 25px 0 20px;
  padding: 20px;
  background: var(--bg-primary);
  border-radius: 16px;
  align-items: center;
  border: 1px solid var(--border-color);
}
.control-group {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  min-width: 300px;
}
.input-group {
  display: flex;
  gap: 15px;
  margin: 25px 0;
  flex-wrap: wrap;
  align-items: flex-end;
}
select, input[type="text"], input[type="date"], input[type="url"] {
  padding: 14px;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 16px;
  transition: var(--transition);
  min-width: 160px;
}
select:focus, input[type="text"]:focus, input[type="date"]:focus, input[type="url"]:focus {
  outline: none;
  border-color: var(--accent-blue);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: var(--card-shadow);
}
th {
  background: var(--header-bg);
  color: var(--header-text);
  padding: 16px 15px;
  text-align: left;
  font-weight: 600;
  font-size: 1.05rem;
}
td {
  padding: 14px 15px;
  border-bottom: 1px solid var(--border-color);
}
tr:last-child td { border-bottom: none }
tr:hover td { background: rgba(59, 130, 246, 0.06) }
.status-ok { color: var(--accent-green); font-weight: 600; display: flex; align-items: center; gap: 6px; }
.status-warning { color: var(--accent-yellow); font-weight: 600; display: flex; align-items: center; gap: 6px; }
.status-old { color: var(--accent-red); font-weight: 600; display: flex; align-items: center; gap: 6px; }
.empty-state {
  text-align: center;
  padding: 50px 20px;
  color: var(--text-secondary);
  font-style: italic;
  font-size: 1.2rem;
  background: var(--bg-primary);
  border-radius: 16px;
  margin: 10px 0;
}
.samsung-highlight {
  background: rgba(245, 158, 11, 0.12) !important;
  border-left: 5px solid var(--accent-yellow);
}
.link-cell a {
  color: var(--accent-blue);
  text-decoration: none;
  font-weight: 500;
  display: inline-block;
  margin: 2px 0;
}
.link-cell a:hover {
  text-decoration: underline;
}
.link-cell {
  word-break: break-word;
}
.link-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 0.85rem;
  font-weight: 600;
  margin: 2px 0;
  background: var(--accent-blue);
  color: white;
}
.link-badge.flipkart { background: #f97316; }
.link-badge.custom { background: #8b5cf6; }
.notification-popup {
  position: fixed;
  top: 80px;
  right: 30px;
  background: var(--bg-secondary);
  border-radius: 16px;
  box-shadow: 0 10px 35px rgba(0,0,0,0.25);
  padding: 20px;
  width: 380px;
  z-index: 1000;
  display: none;
  border-left: 5px solid var(--accent-red);
  animation: slideIn 0.3s ease-out;
  max-height: 80vh;
  overflow-y: auto;
}
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
.notification-popup h3 {
  margin: 0 0 15px 0;
  color: var(--accent-red);
  display: flex;
  align-items: center;
  gap: 10px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border-color);
}
.notification-item {
  background: var(--bg-primary);
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 12px;
  border-left: 3px solid var(--accent-yellow);
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}
.notification-actions {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  justify-content: flex-end;
}
.notification-badge {
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--accent-red);
  color: white;
  border-radius: 50%;
  width: 26px;
  height: 26px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 14px;
  border: 3px solid var(--bg-secondary);
  box-shadow: 0 0 8px rgba(0,0,0,0.3);
  z-index: 10;
}
#notificationBell {
  position: fixed;
  top: 25px;
  right: 25px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: var(--accent-blue);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
  cursor: pointer;
  z-index: 999;
  transition: var(--transition);
  border: none;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
  70% { box-shadow: 0 0 0 12px rgba(59, 130, 246, 0); }
  100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
}
#notificationBell:hover {
  transform: scale(1.08) rotate(5deg);
  box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
}
.footer {
  text-align: center;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid var(--border-color);
  color: var(--text-secondary);
  font-size: 0.95rem;
  line-height: 1.5;
}
.user-badge {
  position: absolute;
  top: 25px;
  left: 25px;
  background: var(--accent-green);
  color: white;
  padding: 6px 15px;
  border-radius: 20px;
  font-weight: 600;
  box-shadow: 0 3px 10px rgba(0,0,0,0.15);
  z-index: 100;
  display: none;
}
.settings-section {
  margin: 25px 0;
  padding: 25px;
  background: var(--bg-primary);
  border-radius: 16px;
  border: 1px solid var(--border-color);
}
.settings-section h3 {
  margin-bottom: 15px;
  color: var(--header-bg);
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 1.3rem;
}
.toggle-group {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  background: rgba(59, 130, 246, 0.08);
  border-radius: 12px;
  margin-bottom: 12px;
}
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 52px;
  height: 28px;
}
.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: var(--accent-blue);
}
input:checked + .slider:before {
  transform: translateX(24px);
}
.user-item {
  display: flex;
  justify-content: space-between;
  padding: 12px 15px;
  background: rgba(59, 130, 246, 0.08);
  border-radius: 12px;
  margin-bottom: 10px;
  align-items: center;
}
.user-management { margin-top: 20px; }
.add-user-form {
  display: none;
  margin-top: 20px;
  padding: 20px;
  background: var(--bg-primary);
  border-radius: 16px;
  border: 1px solid var(--border-color);
}
@media (max-width: 768px) {
  .stats-panel { grid-template-columns: 1fr; gap: 15px; }
  .actions-bar { flex-direction: column; align-items: stretch; }
  .control-group { flex-direction: column; align-items: stretch; }
  .input-group { flex-direction: column; }
  .btn { width: 100%; }
  .modal-content { 
    padding: 25px; 
    margin: 15px;
    max-height: 95vh;
  }
  .modal h2 { font-size: 1.8rem; margin-bottom: 20px; }
  .btn-back { 
    padding: 18px; 
    font-size: 1.2rem;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 450px;
    z-index: 2001;
    border-radius: 16px;
  }
  .notification-popup { width: 90%; right: 5%; top: 90px; }
  .top-bar { flex-direction: column; top: 15px; right: 15px; }
  .btn-dark, .btn-settings { width: 42px; height: 42px; }
  table { font-size: 0.9rem; }
  th, td { padding: 10px 8px; }
  .toggle-group { flex-direction: column; align-items: flex-start; gap: 10px; }
  .settings-section { padding: 20px; margin: 20px 0; }
}
</style>
</head>
<body>
<!-- LOGIN MODAL -->
<div id="loginModal">
  <div class="modal-content">
    <h2>üîí Secure Login</h2>
    <p style="text-align:center; margin-bottom:25px; color:var(--text-secondary)">Please authenticate to access your mobile tracker</p>
    <select id="userSelect" style="margin-top:10px"></select>
    <input type="password" id="loginPassword" placeholder="Enter password (Default: 12345)" autocomplete="current-password">
    <p class="error" id="loginError"></p>
    <div class="modal-buttons">
      <button class="btn btn-primary" onclick="attemptLogin()">üîì Login</button>
      <button class="btn btn-cancel" onclick="document.getElementById('loginPassword').value=''">‚Ü∫ Reset</button>
    </div>
    <p style="text-align:center; margin-top:25px; font-size:0.9rem; color:var(--text-secondary)">
      ‚Ä¢ Session expires when tab is closed or refreshed<br>
      ‚Ä¢ All data is securely stored in your browser
    </p>
  </div>
</div>

<!-- EDIT MODAL -->
<div id="editModal" style="display:none">
  <div class="modal-content">
    <h2>‚úèÔ∏è Edit Device</h2>
    <input type="hidden" id="editDeviceId">
    <select id="editBrand">
      <option>Samsung</option><option>Apple</option><option>Vivo</option>
      <option>Oppo</option><option>Redmi</option><option>Realme</option>
      <option>OnePlus</option><option>Motorola</option>
      <option>Infinix</option><option>Tecno</option><option>Nothing</option>
    </select>
    <input type="text" id="editModel" placeholder="Model Name (e.g., Galaxy S24)">
    <input type="date" id="editDate">
    <div id="editLinkFields"></div>
    <p class="error" id="editError"></p>
    <div class="modal-buttons">
      <button class="btn btn-primary" onclick="saveEdit()">‚úÖ Save Changes</button>
      <button class="btn btn-cancel" onclick="closeEditModal()">CloseOperation</button>
    </div>
  </div>
</div>

<!-- APP CONTAINER (HIDDEN UNTIL LOGIN) -->
<div id="appContainer">
  <div class="container">
    <div class="top-bar">
      <button class="btn-dark" onclick="toggleDarkMode()" title="Toggle Dark Mode">‚òÄÔ∏è</button>
      <button class="btn-settings" onclick="openSettings()" title="Settings">‚öôÔ∏è</button>
    </div>
    <div class="user-badge" id="userBadge"></div>
    
    <div class="header">
      <h1>üì± Mobile Tracker Pro</h1>
      <p class="subtitle">Track devices ‚Ä¢ Plan replacements ‚Ä¢ Stay organized</p>
    </div>
    
    <div class="stats-panel">
      <div class="stats-item">
        <span class="stats-label">TOTAL DEVICES</span>
        <span class="stats-value" id="totalStat">0</span>
      </div>
      <div class="stats-item">
        <span class="stats-label">OLD DEVICES</span>
        <span class="stats-value" id="oldStat">0</span>
      </div>
      <div class="stats-item">
        <span class="stats-label">SAFE DEVICES</span>
        <span class="stats-value" id="safeStat">0</span>
      </div>
    </div>
    
    <h2 style="margin-top: 10px; color: var(--header-bg); display: flex; align-items: center; gap: 12px; font-size: 1.6rem">
      ‚ûï Add New Device
    </h2>
    <div class="input-group">
      <select id="brand">
        <option>Samsung</option><option>Apple</option><option>Vivo</option>
        <option>Oppo</option><option>Redmi</option><option>Realme</option>
        <option>OnePlus</option><option>Motorola</option>
        <option>Infinix</option><option>Tecno</option><option>Nothing</option>
      </select>
      <input id="model" placeholder="Model Name (e.g., Galaxy S24)">
      <input type="date" id="date">
      <div id="addLinkFields"></div>
      <button class="btn btn-primary" onclick="addMobile()">‚ú® Add Device</button>
    </div>
    
    <h2 style="margin-top: 25px; color: var(--header-bg); display: flex; align-items: center; gap: 12px; font-size: 1.6rem">
      üì± Tracked Devices <span id="countBadge" class="btn btn-success" style="padding:6px 15px; font-size:0.95rem; margin-left:10px">0 devices</span>
    </h2>
    
    <div class="actions-bar">
      <div class="control-group">
        <input type="text" id="searchBox" placeholder="Search by model or brand..." style="flex:1; min-width: 220px">
        <button class="btn btn-primary" onclick="searchDevices()">üîç Search</button>
        <button class="btn btn-cancel" onclick="clearSearch()">‚Ü∫ Clear</button>
      </div>
      <div class="control-group">
        <button id="oldOnlyBtn" class="btn btn-old" onclick="toggleOldOnly()">Show Old Only</button>
        <button id="sortBtn" class="btn btn-sort" onclick="toggleSort()">Sort by Days</button>
      </div>
    </div>
    
    <table>
      <thead>
        <tr>
          <th>Brand</th>
          <th>Model</th>
          <th>Days Used</th>
          <th>Status</th>
          <th>Action</th>
          <th>Link</th>
        </tr>
      </thead>
      <tbody id="deviceList">
        <tr class="empty-state">
          <td colspan="6">No devices added yet. Add your first mobile device!</td>
        </tr>
      </tbody>
    </table>
    
    <div class="footer">
      <p>üì± Mobile Tracker Pro ‚Ä¢ Enterprise Edition</p>
      <p>All data stored locally in your browser ‚Ä¢ Session expires on tab close/refresh</p>
      <p style="margin-top:8px; font-weight:500">üîí Your privacy is our priority ‚Ä¢ No data leaves your device</p>
    </div>
  </div>
  
  <!-- NOTIFICATION BELL -->
  <button id="notificationBell" onclick="showNotifications()">üîî<span class="notification-badge" id="bellBadge">0</span></button>
  
  <!-- NOTIFICATION POPUP -->
  <div id="notificationPopup" class="notification-popup">
    <h3>‚ö†Ô∏è Replacement Alerts</h3>
    <div id="notificationList"></div>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" style="display:none">
  <div class="modal-content">
    <h2>‚öôÔ∏è Settings</h2>
    
    <!-- SECTION 1: ACCESS CONTROL -->
    <div class="settings-section">
      <h3>üîê Access Control</h3>
      <div class="toggle-group">
        <span><strong>Website Access Mode</strong><br>
          <span style="font-size:0.9rem; color:var(--text-secondary); margin-top: 5px; display: block">
            üîí Private: Password required<br>
            üåê Public: Direct access
          </span>
        </span>
        <label class="toggle-switch">
          <input type="checkbox" id="accessModeToggle">
          <span class="slider"></span>
        </label>
      </div>
      <p style="font-size:0.9rem; color:var(--text-secondary); margin-top:15px; line-height: 1.5">
        <strong>Note:</strong> Page will refresh to apply changes. Only Owner can modify this setting.
      </p>
    </div>
    
    <!-- SECTION 2: LINK OPTIONS -->
    <div class="settings-section">
      <h3>üîó Link Options</h3>
      <p style="margin-bottom:20px; color:var(--text-secondary); line-height: 1.5">
        Enable/disable link fields for devices. Only enabled links will appear in the table.
      </p>
      <div class="toggle-group">
        <span><strong>Amazon Link</strong><br>
          <span style="font-size:0.85rem; color:var(--text-secondary); margin-top: 5px; display: block">Show Amazon link field</span>
        </span>
        <label class="toggle-switch">
          <input type="checkbox" id="amazonLinkToggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="toggle-group">
        <span><strong>Flipkart Link</strong><br>
          <span style="font-size:0.85rem; color:var(--text-secondary); margin-top: 5px; display: block">Show Flipkart link field</span>
        </span>
        <label class="toggle-switch">
          <input type="checkbox" id="flipkartLinkToggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="toggle-group">
        <span><strong>Custom Link</strong><br>
          <span style="font-size:0.85rem; color:var(--text-secondary); margin-top: 5px; display: block">Show custom URL field</span>
        </span>
        <label class="toggle-switch">
          <input type="checkbox" id="customLinkToggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>
    
    <!-- SECTION 3: SECURITY -->
    <div class="settings-section">
      <h3>üîê Change Password</h3>
      <input type="password" id="currentPassword" placeholder="Current Password">
      <input type="password" id="newPassword" placeholder="New Password (min 4 characters)">
      <input type="password" id="confirmPassword" placeholder="Confirm New Password">
      <p class="error" id="passwordError"></p>
      <button class="btn btn-primary" onclick="changePassword()">‚úÖ Change Password</button>
    </div>
    
    <div class="settings-section" id="userManagementSection">
      <h3>üë• User Management</h3>
      <p style="margin-bottom:20px; color:var(--text-secondary); line-height: 1.5">
        Maximum 5 users allowed. Manage user accounts and permissions.
      </p>
      <div id="userList"></div>
      <button class="btn btn-primary" onclick="showAddUserForm()" id="addUserBtn">‚ûï Add User</button>
      
      <div class="add-user-form" id="addUserForm">
        <input type="text" id="newUserName" placeholder="User Name">
        <input type="password" id="newUserPassword" placeholder="Password (min 4 characters)">
        <input type="password" id="confirmUserPassword" placeholder="Confirm Password">
        <p class="error" id="userError"></p>
        <div class="modal-buttons">
          <button class="btn btn-success" onclick="addUser()">‚úÖ Create User</button>
          <button class="btn btn-cancel" onclick="hideAddUserForm()">‚Ü∫ Cancel</button>
        </div>
      </div>
    </div>
    
    <!-- SECTION 4: DATA MANAGEMENT -->
    <div class="settings-section">
      <h3>üßπ Data Management</h3>
      <p style="margin-bottom:15px; color:var(--text-secondary); line-height: 1.5">
        Clear all data including devices and user accounts. This action cannot be undone.
      </p>
      <button class="btn btn-delete" onclick="clearAllData()" style="width:100%; padding:16px; font-size:1.1rem">üóëÔ∏è CLEAR ALL DATA</button>
      <p style="text-align:center; margin-top:12px; color:var(--accent-red); font-weight:500; font-size: 0.85rem">
        Warning: This will permanently delete all devices and user accounts
      </p>
    </div>
    
    <!-- NAVIGATION BUTTONS -->
    <div class="modal-buttons" style="margin-top:10px; margin-bottom: 80px;">
      <button class="btn btn-primary" onclick="saveSettings()">‚úÖ Save Settings</button>
      <button class="btn btn-cancel" onclick="closeSettingsModal()">CloseOperation</button>
    </div>
    
    <!-- BACK BUTTON - Sticky at bottom -->
    <button class="btn-back" onclick="closeSettingsModal()">üîô Back to Home</button>
  </div>
</div>

<script>
// ======================
// CORE STATE VARIABLES
// ======================
let devices = [];
let currentUser = null;
let showOnlyOld = false;
let sortOrder = 'asc'; // 'asc' = newest first (low days), 'desc' = oldest first
let darkMode = localStorage.getItem('darkMode') === 'true';
let users = JSON.parse(localStorage.getItem('users')) || [];
let accessMode = localStorage.getItem('accessMode') || 'private'; // 'private' or 'public'
let linkSettings = JSON.parse(localStorage.getItem('linkSettings')) || {
  amazon: true,
  flipkart: true,
  custom: true
};

// ======================
// INITIALIZATION
// ======================
document.addEventListener('DOMContentLoaded', () => {
  // Initialize users if first time
  if (users.length === 0) {
    users = [{
      id: 'owner',
      name: 'Owner',
      password: hashPassword('12345'), // Default password
      role: 'owner'
    }];
    localStorage.setItem('users', JSON.stringify(users));
  }
  
  // Set today's date
  const today = new Date();
  document.getElementById("date").valueAsDate = today;
  
  // Apply dark mode if saved
  if (darkMode) {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.querySelector('.btn-dark').textContent = 'üåô';
  }
  
  // Load devices
  devices = JSON.parse(localStorage.getItem("devices")) || [];
  
  // Load link settings
  linkSettings = JSON.parse(localStorage.getItem('linkSettings')) || {
    amazon: true,
    flipkart: true,
    custom: true
  };
  
  // Initialize access mode toggle
  document.getElementById('accessModeToggle').checked = (accessMode === 'public');
  document.getElementById('amazonLinkToggle').checked = linkSettings.amazon;
  document.getElementById('flipkartLinkToggle').checked = linkSettings.flipkart;
  document.getElementById('customLinkToggle').checked = linkSettings.custom;
  
  // Check access mode and show/hide login
  if (accessMode === 'public') {
    // Public mode - show app directly
    currentUser = users[0]; // Auto-login as owner
    document.getElementById('appContainer').style.display = 'block';
    document.getElementById('userBadge').style.display = 'block';
    document.getElementById('userBadge').textContent = 'üëë Owner';
    document.querySelector('.btn-settings').style.display = 'flex';
    document.getElementById('userManagementSection').style.display = 'block';
    render();
  } else {
    // Private mode - show login
    document.getElementById('loginModal').style.display = 'flex';
  }
  
  // Populate user select in login modal
  const userSelect = document.getElementById('userSelect');
  userSelect.innerHTML = '';
  users.forEach(user => {
    const option = document.createElement('option');
    option.value = user.id;
    option.textContent = `${user.role === 'owner' ? 'üëë ' : 'üë§ '} ${user.name}`;
    userSelect.appendChild(option);
  });
});

// ======================
// LOGIN SYSTEM
// ======================
function hashPassword(password) {
  // Simple hash for demo (not secure for production)
  return btoa(password + "mobile_tracker_salt_2024");
}

function attemptLogin() {
  const userId = document.getElementById('userSelect').value;
  const password = document.getElementById('loginPassword').value;
  const errorEl = document.getElementById('loginError');
  
  // Find user
  const user = users.find(u => u.id === userId);
  
  if (!user) {
    errorEl.textContent = "User not found!";
    return;
  }
  
  // Validate password
  if (user.password !== hashPassword(password)) {
    errorEl.textContent = "Incorrect password! (Default: 12345)";
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginPassword').focus();
    return;
  }
  
  // Successful login
  currentUser = user;
  document.getElementById('loginModal').style.display = 'none';
  document.getElementById('appContainer').style.display = 'block';
  document.getElementById('userBadge').style.display = 'block';
  document.getElementById('userBadge').textContent = `${user.role === 'owner' ? 'üëë' : 'üë§'} ${user.name}`;
  
  // Show/hide settings based on role
  if (user.role !== 'owner') {
    document.querySelector('.btn-settings').style.display = 'none';
    document.getElementById('userManagementSection').style.display = 'none';
  } else {
    document.querySelector('.btn-settings').style.display = 'flex';
    document.getElementById('userManagementSection').style.display = 'block';
  }
  
  // Render app
  render();
}

// ======================
// CORE APP FUNCTIONS
// ======================
function addMobile() {
  const brand = document.getElementById("brand").value;
  const model = document.getElementById("model").value.trim();
  const dateStr = document.getElementById("date").value;
  
  if (model.length < 2) return showError("Model name must be at least 2 characters");
  if (!dateStr) return showError("Please select purchase date");
  
  const purchaseDate = new Date(dateStr);
  const today = new Date();
  today.setHours(0,0,0,0);
  purchaseDate.setHours(0,0,0,0);
  
  if (purchaseDate > today) return showError("Purchase date cannot be in the future!");
  
  // Collect link data based on enabled settings
  const links = {};
  if (linkSettings.amazon) {
    const amazonVal = document.getElementById('addAmazonLink')?.value.trim() || '';
    if (amazonVal) links.amazon = amazonVal;
  }
  if (linkSettings.flipkart) {
    const flipkartVal = document.getElementById('addFlipkartLink')?.value.trim() || '';
    if (flipkartVal) links.flipkart = flipkartVal;
  }
  if (linkSettings.custom) {
    const customVal = document.getElementById('addCustomLink')?.value.trim() || '';
    if (customVal) links.custom = customVal;
  }
  
  devices.push({
    id: Date.now(),
    brand,
    model,
    purchaseDate: dateStr,
    links: links // Store as object
  });
  
  saveData();
  render();
  document.getElementById("model").value = "";
  document.getElementById("date").valueAsDate = new Date();
  
  // Clear link fields
  if (linkSettings.amazon) document.getElementById('addAmazonLink').value = '';
  if (linkSettings.flipkart) document.getElementById('addFlipkartLink').value = '';
  if (linkSettings.custom) document.getElementById('addCustomLink').value = '';
  
  showTemporaryMessage(`‚úÖ ${brand} ${model} added successfully!`, "success");
}

function deleteDevice(id) {
  if (!confirm("‚ùì Delete this device?\nThis action cannot be undone.")) return;
  
  devices = devices.filter(d => d.id !== id);
  saveData();
  render();
  showTemporaryMessage("‚úÖ Device deleted successfully!", "success");
  
  // Close notification popup if open
  document.getElementById("notificationPopup").style.display = "none";
}

function editDevice(id) {
  const device = devices.find(d => d.id === id);
  if (!device) return;
  
  document.getElementById("editDeviceId").value = device.id;
  document.getElementById("editBrand").value = device.brand;
  document.getElementById("editModel").value = device.model;
  document.getElementById("editDate").value = device.purchaseDate;
  
  // Generate link fields for edit modal
  generateEditLinkFields(device.links || {});
  
  document.getElementById("editError").textContent = '';
  document.getElementById("editModal").style.display = "flex";
}

function generateEditLinkFields(links) {
  const container = document.getElementById('editLinkFields');
  container.innerHTML = '<h3 style="margin:15px 0 10px 0; color:var(--header-bg)">Links</h3>';
  
  if (linkSettings.amazon) {
    container.innerHTML += `
      <input type="url" id="editAmazonLink" placeholder="Amazon Link (Optional)" value="${links.amazon || ''}">
    `;
  }
  
  if (linkSettings.flipkart) {
    container.innerHTML += `
      <input type="url" id="editFlipkartLink" placeholder="Flipkart Link (Optional)" value="${links.flipkart || ''}">
    `;
  }
  
  if (linkSettings.custom) {
    container.innerHTML += `
      <input type="url" id="editCustomLink" placeholder="Custom Link (Optional)" value="${links.custom || ''}">
    `;
  }
}

function saveEdit() {
  const id = parseInt(document.getElementById("editDeviceId").value);
  const brand = document.getElementById("editBrand").value;
  const model = document.getElementById("editModel").value.trim();
  const dateStr = document.getElementById("editDate").value;
  const errorEl = document.getElementById("editError");
  
  if (model.length < 2) {
    errorEl.textContent = "Model name must be at least 2 characters";
    return;
  }
  
  if (!dateStr) {
    errorEl.textContent = "Please select purchase date";
    return;
  }
  
  const purchaseDate = new Date(dateStr);
  const today = new Date();
  today.setHours(0,0,0,0);
  purchaseDate.setHours(0,0,0,0);
  
  if (purchaseDate > today) {
    errorEl.textContent = "Purchase date cannot be in the future!";
    return;
  }
  
  const index = devices.findIndex(d => d.id === id);
  if (index === -1) {
    errorEl.textContent = "Device not found!";
    return;
  }
  
  // Collect link data
  const links = {};
  if (linkSettings.amazon) {
    const amazonVal = document.getElementById('editAmazonLink')?.value.trim() || '';
    if (amazonVal) links.amazon = amazonVal;
  }
  if (linkSettings.flipkart) {
    const flipkartVal = document.getElementById('editFlipkartLink')?.value.trim() || '';
    if (flipkartVal) links.flipkart = flipkartVal;
  }
  if (linkSettings.custom) {
    const customVal = document.getElementById('editCustomLink')?.value.trim() || '';
    if (customVal) links.custom = customVal;
  }
  
  devices[index] = {
    ...devices[index],
    brand,
    model,
    purchaseDate: dateStr,
    links: links
  };
  
  saveData();
  closeEditModal();
  render();
  showTemporaryMessage("‚úÖ Device updated successfully!", "success");
}

function closeEditModal() {
  document.getElementById("editModal").style.display = "none";
}

function saveData() {
  localStorage.setItem("devices", JSON.stringify(devices));
}

function render() {
  const today = new Date();
  today.setHours(0,0,0,0);
  
  // Calculate days and status for each device
  const devicesWithStats = devices.map(device => {
    const purchaseDate = new Date(device.purchaseDate);
    purchaseDate.setHours(0,0,0,0);
    const days = Math.floor((today - purchaseDate) / 86400000); // milliseconds to days
    
    // Status based on days: 0-299 OK, 300-364 Warning, 365+ Old
    let status = 'ok';
    if (days >= 365) status = 'old';
    else if (days >= 300) status = 'warning';
    
    return {
      ...device,
      days,
      status,
      isOld: days >= 365,
      isSamsungOld: (device.brand === "Samsung" && days >= 365)
    };
  });
  
  // Filter: show only old devices if toggle is active
  let displayDevices = showOnlyOld 
    ? devicesWithStats.filter(d => d.isOld) 
    : [...devicesWithStats];
  
  // Filter by search term
  const searchTerm = document.getElementById("searchBox").value.trim().toLowerCase();
  if (searchTerm) {
    displayDevices = displayDevices.filter(d => 
      d.model.toLowerCase().includes(searchTerm) || 
      d.brand.toLowerCase().includes(searchTerm)
    );
  }
  
  // Sort devices
  displayDevices.sort((a, b) => {
    if (sortOrder === 'asc') return a.days - b.days; // Newest first (low days)
    else return b.days - a.days; // Oldest first (high days)
  });
  
  // Update stats
  const total = devices.length;
  const oldCount = devicesWithStats.filter(d => d.isOld).length;
  const safeCount = total - oldCount;
  
  document.getElementById("totalStat").textContent = total;
  document.getElementById("oldStat").textContent = oldCount;
  document.getElementById("safeStat").textContent = safeCount;
  document.getElementById("countBadge").textContent = `${displayDevices.length} devices`;
  
  // Update notification badge
  document.getElementById("bellBadge").textContent = oldCount;
  document.getElementById("bellBadge").style.display = oldCount > 0 ? "flex" : "none";
  
  // Generate link fields for add form
  generateAddLinkFields();
  
  // Render table
  const tableBody = document.getElementById("deviceList");
  if (displayDevices.length === 0) {
    tableBody.innerHTML = searchTerm 
      ? `<tr class="empty-state"><td colspan="6">No devices found matching "${searchTerm}"</td></tr>`
      : `<tr class="empty-state"><td colspan="6">No devices to display. ${showOnlyOld ? 'Try turning off "Show Old Only" filter' : 'Add your first device!'}</td></tr>`;
    return;
  }
  
  tableBody.innerHTML = displayDevices.map(device => {
    // Determine status display
    let statusDisplay = '';
    let statusClass = '';
    if (device.status === 'ok') {
      statusDisplay = 'üü¢ OK';
      statusClass = 'status-ok';
    } else if (device.status === 'warning') {
      statusDisplay = `üü° Warning (${device.days} days)`;
      statusClass = 'status-warning';
    } else {
      statusDisplay = `üî¥ ${Math.floor(device.days/365)} year${Math.floor(device.days/365) > 1 ? 's' : ''} old`;
      statusClass = 'status-old';
    }
    
    // Link display - show only enabled links
    let linkDisplay = '';
    const links = device.links || {};
    
    if (linkSettings.amazon && links.amazon) {
      linkDisplay += `<a href="${links.amazon}" target="_blank" rel="noopener noreferrer" class="link-badge">üõí Amazon</a><br>`;
    }
    
    if (linkSettings.flipkart && links.flipkart) {
      linkDisplay += `<a href="${links.flipkart}" target="_blank" rel="noopener noreferrer" class="link-badge flipkart">üõí Flipkart</a><br>`;
    }
    
    if (linkSettings.custom && links.custom) {
      linkDisplay += `<a href="${links.custom}" target="_blank" rel="noopener noreferrer" class="link-badge custom">üîó Custom Link</a><br>`;
    }
    
    if (!linkDisplay) {
      linkDisplay = '<span style="color:var(--text-secondary)">‚Äî</span>';
    }
    
    return `
      <tr class="${device.isSamsungOld ? 'samsung-highlight' : ''}">
        <td><strong>${device.brand}</strong></td>
        <td>${device.model}</td>
        <td><b>${device.days}</b> days</td>
        <td class="${statusClass}">${statusDisplay}</td>
        <td>
          <button class="btn btn-primary" style="padding:6px 10px; margin-right:5px;" onclick="editDevice(${device.id})">‚úèÔ∏è Edit</button>
          <button class="btn btn-delete" style="padding:6px 10px;" onclick="deleteDevice(${device.id})">üóëÔ∏è Delete</button>
        </td>
        <td class="link-cell">${linkDisplay}</td>
      </tr>
    `;
  }).join('');
  
  // Update notification popup content
  updateNotifications(devicesWithStats.filter(d => d.isOld));
}

function generateAddLinkFields() {
  const container = document.getElementById('addLinkFields');
  container.innerHTML = '';
  
  if (linkSettings.amazon) {
    container.innerHTML += `
      <input type="url" id="addAmazonLink" placeholder="Amazon Link (Optional)" style="flex:1; min-width:200px">
    `;
  }
  
  if (linkSettings.flipkart) {
    container.innerHTML += `
      <input type="url" id="addFlipkartLink" placeholder="Flipkart Link (Optional)" style="flex:1; min-width:200px">
    `;
  }
  
  if (linkSettings.custom) {
    container.innerHTML += `
      <input type="url" id="addCustomLink" placeholder="Custom Link (Optional)" style="flex:1; min-width:200px">
    `;
  }
}

function updateNotifications(oldDevices) {
  const popupList = document.getElementById("notificationList");
  
  if (oldDevices.length === 0) {
    popupList.innerHTML = `<div style="text-align:center; padding:20px; color:var(--text-secondary)">
      üéâ No old devices found!<br>All devices are under 1 year old.
    </div>`;
    return;
  }
  
  popupList.innerHTML = oldDevices.map(device => `
    <div class="notification-item">
      <strong>${device.brand} ${device.model}</strong><br>
      <span style="color:var(--accent-red); font-weight:500">${device.days} days old</span>
      <div class="notification-actions">
        <button class="btn btn-delete" onclick="deleteDevice(${device.id})">üóëÔ∏è Delete Device</button>
        <button class="btn btn-cancel" onclick="this.closest('.notification-item').remove()">‚ùå Close Alert</button>
      </div>
    </div>
  `).join('');
}

// ======================
// UI CONTROL FUNCTIONS
// ======================
function toggleOldOnly() {
  showOnlyOld = !showOnlyOld;
  document.getElementById("oldOnlyBtn").classList.toggle("active", showOnlyOld);
  document.getElementById("oldOnlyBtn").innerHTML = showOnlyOld 
    ? '‚úÖ Show All Devices' 
    : '‚ö†Ô∏è Show Old Only';
  document.getElementById("oldOnlyBtn").style.background = showOnlyOld ? '#10b981' : '';
  render();
}

function toggleSort() {
  sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
  const btn = document.getElementById("sortBtn");
  btn.innerHTML = sortOrder === 'asc' 
    ? '‚Üë Newest First' 
    : '‚Üì Oldest First';
  btn.style.background = sortOrder === 'asc' ? '#3b82f6' : '#ef4444';
  render();
}

function searchDevices() {
  render();
  const count = document.querySelectorAll("#deviceList tr").length;
  if (count > 0 && !document.querySelector(".empty-state")) {
    showTemporaryMessage(`‚úÖ Found ${count} device${count > 1 ? 's' : ''}`, "success");
  }
}

function clearSearch() {
  document.getElementById("searchBox").value = "";
  render();
}

// ======================
// NOTIFICATION SYSTEM
// ======================
function showNotifications() {
  const popup = document.getElementById("notificationPopup");
  const oldCount = devices.filter(d => {
    const purchaseDate = new Date(d.purchaseDate);
    const today = new Date();
    today.setHours(0,0,0,0);
    purchaseDate.setHours(0,0,0,0);
    return Math.floor((today - purchaseDate) / 86400000) >= 365;
  }).length;
  
  if (oldCount === 0) {
    showTemporaryMessage("‚úÖ All devices are under 1 year old!", "success");
    return;
  }
  
  popup.style.display = "block";
  
  // Auto-close after 15 seconds
  setTimeout(() => {
    if (popup.style.display === "block") {
      closeNotifications();
    }
  }, 15000);
}

function closeNotifications() {
  document.getElementById("notificationPopup").style.display = "none";
}

// ======================
// SETTINGS SYSTEM
// ======================
function openSettings() {
  if (currentUser.role !== 'owner') {
    alert("üîí Only the Owner can access Settings!");
    return;
  }
  
  // Reset error messages
  document.getElementById('passwordError').textContent = '';
  document.getElementById('userError').textContent = '';
  
  // Show settings modal
  document.getElementById('settingsModal').style.display = 'flex';
  
  // Render user list
  renderUserList();
}

function closeSettingsModal() {
  document.getElementById('settingsModal').style.display = 'none';
  document.getElementById('addUserForm').style.display = 'none';
}

function saveSettings() {
  // Save access mode
  const newAccessMode = document.getElementById('accessModeToggle').checked ? 'public' : 'private';
  
  // Save link settings
  const newLinkSettings = {
    amazon: document.getElementById('amazonLinkToggle').checked,
    flipkart: document.getElementById('flipkartLinkToggle').checked,
    custom: document.getElementById('customLinkToggle').checked
  };
  
  // Save to localStorage
  localStorage.setItem('accessMode', newAccessMode);
  localStorage.setItem('linkSettings', JSON.stringify(newLinkSettings));
  
  // Update local variables
  accessMode = newAccessMode;
  linkSettings = newLinkSettings;
  
  // Show message and refresh page to apply access mode changes
  showTemporaryMessage("‚úÖ Settings saved successfully!", "success");
  
  // Refresh page if access mode changed
  if ((newAccessMode === 'public' && accessMode === 'private') || 
      (newAccessMode === 'private' && accessMode === 'public')) {
    setTimeout(() => {
      location.reload();
    }, 1000);
  } else {
    render();
    closeSettingsModal();
  }
}

function changePassword() {
  const currentPwd = document.getElementById('currentPassword').value;
  const newPwd = document.getElementById('newPassword').value;
  const confirmPwd = document.getElementById('confirmPassword').value;
  const errorEl = document.getElementById('passwordError');
  
  // Validate current password
  if (hashPassword(currentPwd) !== currentUser.password) {
    errorEl.textContent = "Current password is incorrect!";
    return;
  }
  
  // Validate new password
  if (newPwd.length < 4) {
    errorEl.textContent = "New password must be at least 4 characters";
    return;
  }
  
  if (newPwd !== confirmPwd) {
    errorEl.textContent = "New passwords do not match!";
    return;
  }
  
  // Update password
  const updatedUsers = users.map(u => 
    u.id === currentUser.id 
      ? {...u, password: hashPassword(newPwd)} 
      : u
  );
  
  users = updatedUsers;
  localStorage.setItem('users', JSON.stringify(users));
  
  // Update current user session
  currentUser.password = hashPassword(newPwd);
  
  // Reset fields and show success
  document.getElementById('currentPassword').value = '';
  document.getElementById('newPassword').value = '';
  document.getElementById('confirmPassword').value = '';
  errorEl.textContent = '';
  showTemporaryMessage("‚úÖ Password changed successfully!", "success");
}

function renderUserList() {
  const userListDiv = document.getElementById('userList');
  userListDiv.innerHTML = '';
  
  // Filter out owner (handled separately)
  const regularUsers = users.filter(u => u.role !== 'owner');
  
  if (regularUsers.length === 0) {
    userListDiv.innerHTML = `<p style="text-align:center; color:var(--text-secondary); padding:15px">
      No additional users added yet
    </p>`;
    return;
  }
  
  regularUsers.forEach(user => {
    userListDiv.innerHTML += `
      <div class="user-item">
        <span><strong>${user.name}</strong> (User)</span>
        <div>
          <button class="btn btn-cancel" onclick="editUser('${user.id}')">‚úèÔ∏è Edit</button>
          <button class="btn btn-delete" onclick="deleteUser('${user.id}')">üóëÔ∏è Delete</button>
        </div>
      </div>
    `;
  });
  
  // Update add user button text based on count
  const addUserBtn = document.getElementById('addUserBtn');
  if (users.length >= 5) {
    addUserBtn.disabled = true;
    addUserBtn.textContent = '‚úÖ Max Users (5)';
    addUserBtn.style.opacity = '0.7';
  } else {
    addUserBtn.disabled = false;
    addUserBtn.textContent = `‚ûï Add User (${users.length}/5)`;
  }
}

function showAddUserForm() {
  if (users.length >= 5) {
    alert("Maximum 5 users allowed!");
    return;
  }
  document.getElementById('addUserForm').style.display = 'block';
  document.getElementById('newUserName').focus();
}

function hideAddUserForm() {
  document.getElementById('addUserForm').style.display = 'none';
  document.getElementById('newUserName').value = '';
  document.getElementById('newUserPassword').value = '';
  document.getElementById('confirmUserPassword').value = '';
  document.getElementById('userError').textContent = '';
}

function addUser() {
  const name = document.getElementById('newUserName').value.trim();
  const pwd = document.getElementById('newUserPassword').value;
  const confirmPwd = document.getElementById('confirmUserPassword').value;
  const errorEl = document.getElementById('userError');
  
  if (name.length < 2) {
    errorEl.textContent = "Name must be at least 2 characters";
    return;
  }
  
  if (pwd.length < 4) {
    errorEl.textContent = "Password must be at least 4 characters";
    return;
  }
  
  if (pwd !== confirmPwd) {
    errorEl.textContent = "Passwords do not match!";
    return;
  }
  
  if (users.length >= 5) {
    errorEl.textContent = "Maximum 5 users allowed!";
    return;
  }
  
  // Create new user
  const newUser = {
    id: 'user_' + Date.now(),
    name: name,
    password: hashPassword(pwd),
    role: 'user'
  };
  
  users.push(newUser);
  localStorage.setItem('users', JSON.stringify(users));
  
  // Reset form and hide
  hideAddUserForm();
  renderUserList();
  showTemporaryMessage(`‚úÖ User "${name}" created successfully!`, "success");
}

function deleteUser(userId) {
  if (!confirm("‚ùì Delete this user?\nThis action cannot be undone.")) return;
  
  // Prevent deleting current user
  if (currentUser.id === userId) {
    alert("‚ùå You cannot delete your own account while logged in!");
    return;
  }
  
  users = users.filter(u => u.id !== userId);
  localStorage.setItem('users', JSON.stringify(users));
  
  renderUserList();
  showTemporaryMessage("‚úÖ User deleted successfully!", "success");
}

function clearAllData() {
  if (!confirm("‚ö†Ô∏è DANGER ZONE!\n\nThis will PERMANENTLY DELETE:\n- All tracked devices\n- All user accounts (except current session)\n\nType 'DELETE' to confirm:")) return;
  
  const confirmation = prompt("Type 'DELETE' to confirm permanent deletion:");
  if (confirmation !== "DELETE") {
    alert("Operation cancelled");
    return;
  }
  
  // Clear devices and reset users to default owner
  localStorage.removeItem("devices");
  localStorage.removeItem("users");
  
  // Reset state
  devices = [];
  users = [{
    id: 'owner',
    name: 'Owner',
    password: hashPassword('12345'),
    role: 'owner'
  }];
  
  // Reinitialize login modal
  const userSelect = document.getElementById('userSelect');
  userSelect.innerHTML = '';
  users.forEach(user => {
    const option = document.createElement('option');
    option.value = user.id;
    option.textContent = `${user.role === 'owner' ? 'üëë ' : 'üë§ '} ${user.name}`;
    userSelect.appendChild(option);
  });
  
  // Close settings and show success
  closeSettingsModal();
  render();
  showTemporaryMessage("‚úÖ All data cleared successfully! Default Owner account restored.", "success");
  
  // Force re-login on next refresh (current session remains until refresh)
  alert("‚ÑπÔ∏è Note: Current session remains active until you refresh or close the tab.\nNext time you open this page, you'll need to login again with default password '12345'.");
}

// ======================
// UTILITY FUNCTIONS
// ======================
function toggleDarkMode() {
  darkMode = !darkMode;
  document.documentElement.setAttribute('data-theme', darkMode ? 'dark' : 'light');
  localStorage.setItem('darkMode', darkMode.toString());
  document.querySelector('.btn-dark').textContent = darkMode ? 'üåô' : '‚òÄÔ∏è';
}

function showError(message) {
  showTemporaryMessage(`‚ö†Ô∏è ${message}`, "error");
}

function showTemporaryMessage(message, type) {
  // Create notification if doesn't exist
  let notification = document.getElementById('tempNotification');
  if (!notification) {
    notification = document.createElement('div');
    notification.id = 'tempNotification';
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.padding = '16px 28px';
    notification.style.borderRadius = '16px';
    notification.style.color = 'white';
    notification.style.fontWeight = '600';
    notification.style.boxShadow = '0 5px 20px rgba(0,0,0,0.3)';
    notification.style.zIndex = '3000';
    notification.style.transform = 'translateX(400px)';
    notification.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
    document.body.appendChild(notification);
  }
  
  // Set content and style
  notification.textContent = message;
  notification.style.background = type === 'success' ? '#10b981' : '#ef4444';
  
  // Show notification
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // Hide after 3 seconds
  setTimeout(() => {
    notification.style.transform = 'translateX(400px)';
    setTimeout(() => {
      notification.style.opacity = '0';
    }, 300);
  }, 3000);
}

// Close modals when clicking outside
window.onclick = function(event) {
  if (event.target.id === 'settingsModal') {
    closeSettingsModal();
  }
  if (event.target.id === 'editModal') {
    closeEditModal();
  }
  if (event.target.id === 'notificationPopup') {
    closeNotifications();
  }
};

// Close notification popup when clicking bell again
document.getElementById('notificationBell').addEventListener('click', (e) => {
  if (document.getElementById('notificationPopup').style.display === 'block') {
    closeNotifications();
    e.stopPropagation();
  }
});

// Allow Enter key for search
document.getElementById("searchBox").addEventListener("keypress", (e) => {
  if (e.key === "Enter") searchDevices();
});

// Allow Enter key for login
document.getElementById("loginPassword").addEventListener("keypress", (e) => {
  if (e.key === "Enter") attemptLogin();
});

// Allow Enter key for edit modal
document.getElementById("editModel").addEventListener("keypress", (e) => {
  if (e.key === "Enter") saveEdit();
});
</script>
</body>
</html>
